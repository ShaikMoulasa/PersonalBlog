<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Study Planner</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#7c3aed;--accent-2:#06b6d4;--good:#10b981;--danger:#ef4444}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; margin:0;background:linear-gradient(180deg,var(--bg),#071226);color:#e6eef8;min-height:100vh}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:20px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);padding:14px;border-radius:12px}

    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=date], input[type=time], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .row{display:flex;gap:10px}
    .btn{display:inline-block;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;background:var(--accent);color:white;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .task{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .task .meta{font-size:13px;color:var(--muted)}
    .pill{padding:6px 8px;border-radius:999px;font-size:12px}
    .pill.low{background:rgba(6,182,212,0.12);color:var(--accent-2)}
    .pill.medium{background:rgba(124,58,237,0.12);color:var(--accent)}
    .pill.high{background:rgba(16,185,129,0.08);color:var(--good)}

    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .search{flex:1}

    .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%}

    .timeline{display:flex;flex-direction:column;gap:12px}
    .empty{color:var(--muted);padding:16px;border-radius:8px;text-align:center}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:900px){.grid{grid-template-columns:1fr;}.brand h1{display:none}.logo{width:36px;height:36px}}

    /* small helpers */
    .small{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px}
    .btn-danger{background:var(--danger);padding:8px 10px;border-radius:8px;color:white}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SS</div>
        <div>
          <h1>Smart Study Planner</h1>
          <div class="small">Create schedules, track progress & get reminders</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn ghost" id="exportBtn">Export</button>
        <button class="btn ghost" id="importBtn">Import</button>
        <input id="fileInput" type="file" accept="application/json" style="display:none">
      </div>
    </header>

    <div class="grid">
      <!-- left column: add/edit task -->
      <aside class="card">
        <h3 style="margin-top:0">Add / Edit Task</h3>
        <form id="taskForm">
          <label>Subject</label>
          <input id="subject" type="text" placeholder="e.g. OS, Math" required>

          <label>Title</label>
          <input id="title" type="text" placeholder="Study chapter 4" required>

          <div class="row" style="margin-top:8px">
            <div style="flex:1">
              <label>Date</label>
              <input id="date" type="date" required>
            </div>
            <div style="width:110px">
              <label>Time</label>
              <input id="time" type="time" required>
            </div>
          </div>

          <label>Duration (mins)</label>
          <input id="duration" type="text" inputmode="numeric" placeholder="60">

          <label>Priority</label>
          <select id="priority">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
          </select>

          <label>Notes (optional)</label>
          <textarea id="notes" rows="3" placeholder="Optional notes"></textarea>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button class="btn" id="saveBtn" type="submit">Save Task</button>
            <button class="btn ghost" id="clearBtn" type="button">Clear</button>
          </div>
        </form>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)">
        <div>
          <div class="small">Overall Progress</div>
          <div class="progress" style="margin-top:8px"><i id="progressBar"></i></div>
          <div class="small" style="margin-top:6px">Completed <strong id="completedCount">0</strong> / <span id="totalCount">0</span></div>
        </div>
      </aside>

      <!-- right column: tasks list / timeline -->
      <main>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="display:flex;gap:12px;align-items:center;flex:1">
              <input id="search" class="search" placeholder="Search tasks or subjects...">
              <select id="filterPriority">
                <option value="all">All priorities</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
              <select id="sortBy">
                <option value="time">Sort: Date/time</option>
                <option value="priority">Sort: Priority</option>
                <option value="subject">Sort: Subject</option>
              </select>
            </div>
            <div style="margin-left:12px"><button class="btn" id="notifyAll">Enable Reminders</button></div>
          </div>

          <div style="margin-top:12px" id="taskList"></div>
          <div id="emptyPlaceholder" class="empty" style="display:none">No tasks yet — add your first study session.</div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin-top:0">Timeline</h3>
          <div class="timeline" id="timeline"></div>
        </div>
      </main>
    </div>

    <footer>Built with ❤️ · LocalStorage · Works offline</footer>
  </div>

  <script>
    // Simple Smart Study Planner - vanilla JS
    const STORAGE_KEY = 'smart-study-planner:v1';
    let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let editingId = null;

    // Elements
    const taskForm = document.getElementById('taskForm');
    const subjectEl = document.getElementById('subject');
    const titleEl = document.getElementById('title');
    const dateEl = document.getElementById('date');
    const timeEl = document.getElementById('time');
    const durationEl = document.getElementById('duration');
    const priorityEl = document.getElementById('priority');
    const notesEl = document.getElementById('notes');
    const taskList = document.getElementById('taskList');
    const emptyPlaceholder = document.getElementById('emptyPlaceholder');
    const progressBar = document.getElementById('progressBar');
    const completedCount = document.getElementById('completedCount');
    const totalCount = document.getElementById('totalCount');
    const searchEl = document.getElementById('search');
    const filterPriority = document.getElementById('filterPriority');
    const sortBy = document.getElementById('sortBy');
    const timeline = document.getElementById('timeline');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const fileInput = document.getElementById('fileInput');
    const notifyAllBtn = document.getElementById('notifyAll');

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      render();
    }

    function uid() { return Math.random().toString(36).slice(2,9); }

    function addTask(data){
      tasks.push(data); save();
    }

    function updateTask(id, patch){
      const i = tasks.findIndex(t=>t.id===id); if(i===-1) return;
      tasks[i] = {...tasks[i], ...patch}; save();
    }

    function deleteTask(id){
      tasks = tasks.filter(t=>t.id!==id); save();
    }

    function clearForm(){
      taskForm.reset(); editingId = null; document.getElementById('saveBtn').textContent = 'Save Task';
    }

    function render(){
      // sort & filter
      let list = [...tasks];
      // search
      const q = searchEl.value.trim().toLowerCase();
      if(q) list = list.filter(t=> (t.title+t.subject+t.notes).toLowerCase().includes(q));
      // priority filter
      if(filterPriority.value!=='all') list = list.filter(t=>t.priority===filterPriority.value);
      // sort
      if(sortBy.value==='time'){
        list.sort((a,b)=> new Date(a.date+'T'+a.time) - new Date(b.date+'T'+b.time));
      }else if(sortBy.value==='priority'){
        const order = {high:0, medium:1, low:2}; list.sort((a,b)=>order[a.priority]-order[b.priority]);
      }else if(sortBy.value==='subject'){
        list.sort((a,b)=>a.subject.localeCompare(b.subject));
      }

      // render task list
      taskList.innerHTML='';
      if(list.length===0){ emptyPlaceholder.style.display='block'; } else { emptyPlaceholder.style.display='none'; }

      list.forEach(t=>{
        const div = document.createElement('div'); div.className='task';
        const left = document.createElement('div');
        left.innerHTML = `<div style="font-weight:700">${escapeHtml(t.title)}</div>
                          <div class="meta">${escapeHtml(t.subject)} · ${formatDateTime(t.date,t.time)} · ${t.duration?t.duration+'m':''}</div>`;
        const right = document.createElement('div');
        right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';
        const pill = document.createElement('div'); pill.className='pill '+(t.priority||'medium'); pill.textContent = t.priority?.toUpperCase()||'MED';
        const checkbox = document.createElement('input'); checkbox.type='checkbox'; checkbox.checked = !!t.done;
        checkbox.addEventListener('change', ()=> updateTask(t.id,{done:checkbox.checked, completedAt: checkbox.checked? new Date().toISOString():null }));

        const actions = document.createElement('div'); actions.className='actions';
        const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='Edit';
        editBtn.addEventListener('click', ()=> startEdit(t.id));
        const delBtn = document.createElement('button'); delBtn.className='btn-danger'; delBtn.textContent='Delete';
        delBtn.addEventListener('click', ()=>{ if(confirm('Delete this task?')) deleteTask(t.id); });

        actions.appendChild(editBtn); actions.appendChild(delBtn);
        right.appendChild(pill); right.appendChild(checkbox); right.appendChild(actions);

        div.appendChild(left); div.appendChild(right);
        taskList.appendChild(div);
      });

      // progress
      const total = tasks.length; const done = tasks.filter(t=>t.done).length;
      const percent = total===0?0:Math.round(done/total*100);
      progressBar.style.width = percent + '%';
      totalCount.textContent = total; completedCount.textContent = done;

      // timeline grouped by date
      renderTimeline(list);
    }

    function renderTimeline(list){
      timeline.innerHTML='';
      const grouped = {};
      list.forEach(t=>{ grouped[t.date] = grouped[t.date]||[]; grouped[t.date].push(t); });
      const keys = Object.keys(grouped).sort();
      if(keys.length===0){ timeline.innerHTML = '<div class="empty">No scheduled sessions</div>'; return; }
      keys.forEach(d=>{
        const box = document.createElement('div');
        const heading = document.createElement('div'); heading.style.fontWeight='700'; heading.textContent = formatDateReadable(d);
        box.appendChild(heading);
        grouped[d].sort((a,b)=>a.time.localeCompare(b.time)).forEach(t=>{
          const r = document.createElement('div'); r.style.display='flex'; r.style.justifyContent='space-between'; r.style.alignItems='center'; r.style.padding='8px 0';
          r.innerHTML = <div><div style="font-weight:600">${escapeHtml(t.time)} — ${escapeHtml(t.title)}</div><div class="small">${escapeHtml(t.subject)} · ${t.duration?t.duration+'m':''}</div></div>;
          const ractions = document.createElement('div'); ractions.style.display='flex'; ractions.style.gap='8px';
          const snooze = document.createElement('button'); snooze.className='btn ghost'; snooze.textContent='Snooze 10m';
          snooze.addEventListener('click', ()=> snoozeTask(t.id,10));
          ractions.appendChild(snooze);
          r.appendChild(ractions);
          box.appendChild(r);
        });
        timeline.appendChild(box);
      });
    }

    function startEdit(id){
      const t = tasks.find(x=>x.id===id); if(!t) return;
      editingId = id; subjectEl.value = t.subject; titleEl.value = t.title; dateEl.value = t.date; timeEl.value = t.time; durationEl.value = t.duration||''; priorityEl.value = t.priority||'medium'; notesEl.value = t.notes||'';
      document.getElementById('saveBtn').textContent = 'Update Task';
    }

    function snoozeTask(id,mins){
      const t = tasks.find(x=>x.id===id); if(!t) return; const dt = new Date(t.date+'T'+t.time); dt.setMinutes(dt.getMinutes()+mins);
      t.date = dt.toISOString().slice(0,10); t.time = dt.toTimeString().slice(0,5); save();
      alert('Snoozed by '+mins+' minutes');
    }

    function formatDateTime(d,tm){
      if(!d) return tm||''; return d+' '+(tm||'');
    }
    function formatDateReadable(d){
      const dt = new Date(d+'T00:00'); return dt.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

    // notifications (works while page is open; for full background notifications you'd need a service worker & push)
    function enableNotifications(){
      if(!('Notification' in window)){ alert('Notifications not supported in this browser'); return; }
      Notification.requestPermission().then(p=>{
        if(p==='granted'){ scheduleNotifications(); notifyAllBtn.textContent='Reminders enabled'; notifyAllBtn.disabled=true; }
      });
    }

    function scheduleNotifications(){
      // clear previous timers
      if(window._plannerTimers) window._plannerTimers.forEach(clearTimeout);
      window.__plannerTimers = [];
      tasks.filter(t=>!t.done).forEach(t=>{
        const when = new Date(t.date+'T'+t.time);
        const ms = when - new Date();
        if(ms>0 && ms<1000*60*60*24*7){ // only schedule within a week
          const id = setTimeout(()=> showNotification(t), ms);
          window.__plannerTimers.push(id);
        }
      });
    }
    function showNotification(task){
      if(Notification.permission!=='granted') return;
      const n = new Notification(task.title, {body: task.subject + (task.duration? ' · '+task.duration+'m':'' )});
      n.onclick = ()=> window.focus();
    }

    // export/import
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(tasks, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'smart-study-planner.json'; a.click(); URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
      reader.onload = ()=>{
        try{ const imported = JSON.parse(reader.result); if(Array.isArray(imported)){ tasks = imported; save(); alert('Imported '+imported.length+' tasks'); } else alert('Invalid file'); }
        catch(er){ alert('Invalid JSON'); }
      };
      reader.readAsText(f);
    });

    // form submit
    taskForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const payload = {
        id: editingId || uid(),
        subject: subjectEl.value.trim(),
        title: titleEl.value.trim(),
        date: dateEl.value,
        time: timeEl.value,
        duration: durationEl.value.trim(),
        priority: priorityEl.value,
        notes: notesEl.value.trim(),
        done: false,
        createdAt: new Date().toISOString()
      };
      if(editingId){ updateTask(editingId, payload); } else { addTask(payload); }
      clearForm();
      // set up notifications if previously enabled
      if(Notification.permission==='granted') scheduleNotifications();
    });

    document.getElementById('clearBtn').addEventListener('click', clearForm);
    searchEl.addEventListener('input', render); filterPriority.addEventListener('change', render); sortBy.addEventListener('change', render);
    notifyAllBtn.addEventListener('click', enableNotifications);

    // initial render
    render();
    // schedule if permissions already granted
    if(Notification.permission==='granted') scheduleNotifications();

    // small helper: seed today's date by default
    (function seedDate(){ const today = new Date(); const s = today.toISOString().slice(0,10); if(!dateEl.value) dateEl.value = s; })();

    // expose for debugging
    window.__planner = {tasks, save, render};
  </script>
</body>
</html>